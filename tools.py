
import pdfid


import pprint
from pdfid import pdfid

pp = pprint.PrettyPrinter(indent=4)

# TEST_FILENAME = 'data/Ben09/Russian_CNAstatement.pdf'
TEST_FILENAME = 'data/f9/bc6d9861b7c963e421b99a1cf9b3ea266b268d5a77a75f88b2914ee9cbb06d6a'

def analyze_pdfs_by_filenames(filenames):
    # 1. Setup
    options = pdfid.get_fake_options()
    options.scan = True
    options.json = True

    # 2. Actual analysis
    list_of_dict = pdfid.PDFiDMain(filenames, options)

    return list_of_dict

def analyze_pdfs_by_buffer(filenames, file_buffers):
    # 1. Setup
    options = pdfid.get_fake_options()
    options.scan = True
    options.json = True

    # 2. Actual analysis
    list_of_dict = pdfid.PDFiDMain(filenames, options, file_buffers)
    return list_of_dict

def disarm_pdfs_by_buffer(filenames, file_buffers):
    # 1. Setup
    options = pdfid.get_fake_options()

    options.disarm = True
    # If you want to return the disarmed buffer 
    # instead of the results dict, set this to True
    options.return_disarmed_buffer = True

    # 2. Actual analysis + disarm
    disarmed_pdf_buffers = pdfid.PDFiDMain(filenames, options, file_buffers)
    return disarmed_pdf_buffers



import os
import glob
def extract_features(p):
    filenames = [p]
    file_buffers = []
    for filename in filenames:
        with open(filename, "rb") as f:
            file_buffers.append(f.read())
    # filenames = ['t.pdf']
    # file_buffers = []
    print(filenames)
    try:

        # 3. Disarm PDF from buffer and return disarmed buffer
        disarmed_pdf_buffers = disarm_pdfs_by_buffer(filenames, file_buffers)
        # 3.1 Analyze PDF from disarmed buffer
        results_3 = analyze_pdfs_by_buffer(filenames, disarmed_pdf_buffers['buffers'])
        
        # os.remove(filenames)


        files = glob.glob('../temp/*')
        for f in files:
            os.remove(f)

        return results_3['reports'][0]
    except:
        print('YAWA')
        return None

        